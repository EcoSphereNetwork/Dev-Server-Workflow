# Nginx-Konfiguration f√ºr die ecospherenet.work Subdomains

# Gemeinsame SSL-Konfiguration
ssl_certificate /etc/nginx/ssl/ecospherenet.work.crt;
ssl_certificate_key /etc/nginx/ssl/ecospherenet.work.key;
ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers HIGH:!aNULL:!MD5;
ssl_prefer_server_ciphers on;
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;

# Gemeinsame Proxy-Konfiguration
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_buffering off;

# n8n Subdomain
server {
    listen 443 ssl;
    server_name n8n.ecospherenet.work;

    location / {
        proxy_pass http://n8n:5678;
    }
}

# AppFlowy Subdomain
server {
    listen 443 ssl;
    server_name appflowy.ecospherenet.work;

    location / {
        proxy_pass http://appflowy:3000;
    }
}

# OpenProject Subdomain
server {
    listen 443 ssl;
    server_name openproject.ecospherenet.work;

    location / {
        proxy_pass http://openproject:8080;
    }
}

# GitLab Subdomain
server {
    listen 443 ssl;
    server_name gitlab.ecospherenet.work;

    location / {
        proxy_pass http://gitlab:80;
    }
}

# Affine Subdomain
server {
    listen 443 ssl;
    server_name affine.ecospherenet.work;

    location / {
        proxy_pass http://affine:3000;
    }
}

# Dev-Server Subdomain
server {
    listen 443 ssl;
    server_name dev-server.ecospherenet.work;

    location / {
        proxy_pass http://dev-server-ui:8080;
    }
}

# Monitoring Subdomain (Grafana, Prometheus)
server {
    listen 443 ssl;
    server_name monitoring.ecospherenet.work;

    location / {
        proxy_pass http://monitoring:3000;  # Grafana Standard-Port
    }
    
    location /prometheus/ {
        proxy_pass http://prometheus:9090/;
    }
    
    location /alertmanager/ {
        proxy_pass http://alertmanager:9093/;
    }
}

# Docker Management Subdomain (Portainer)
server {
    listen 443 ssl;
    server_name docker.ecospherenet.work;

    location / {
        proxy_pass http://portainer:9000;
    }
}

# MCP Server Management Subdomain
server {
    listen 443 ssl;
    server_name mcp.ecospherenet.work;

    location / {
        proxy_pass http://mcp-manager:3000;
    }
}

# API Documentation Subdomain
server {
    listen 443 ssl;
    server_name api.ecospherenet.work;

    location / {
        proxy_pass http://api-docs:8080;
    }
}

# Authentication Subdomain
server {
    listen 443 ssl;
    server_name auth.ecospherenet.work;

    location / {
        proxy_pass http://keycloak:8080;
    }
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name *.ecospherenet.work;
    return 301 https://$host$request_uri;
}
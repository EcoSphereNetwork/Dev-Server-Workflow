{
  "name": "Notification-Service",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "send-notification",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "notification-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.notification_type }}",
              "operation": "equal",
              "value2": "email"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 300],
      "id": "check-notification-type"
    },
    {
      "parameters": {
        "fromEmail": "={{ $json.from || 'system@example.com' }}",
        "toEmail": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "text": "={{ $json.message }}"
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [680, 200],
      "id": "send-email"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.notification_type }}",
              "operation": "equal",
              "value2": "slack"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 400],
      "id": "check-if-slack"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "message",
        "channel": "={{ $json.channel }}",
        "text": "={{ $json.message }}",
        "otherOptions": {
          "attachments": "=[\n  {\n    \"title\": $json.subject,\n    \"title_link\": $json.url || \"\",\n    \"text\": $json.details || \"\",\n    \"color\": $json.color || \"#36a64f\"\n  }\n]"
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [900, 300],
      "id": "send-slack-message"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.notification_type }}",
              "operation": "equal",
              "value2": "teams"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [900, 500],
      "id": "check-if-teams"
    },
    {
      "parameters": {
        "url": "={{ $json.webhook_url }}",
        "messageType": "cardAdaptive",
        "messageCard": {
          "type": "AdaptiveCard",
          "version": "1.2",
          "body": [
            {
              "type": "TextBlock",
              "size": "Medium",
              "weight": "Bolder",
              "text": "={{ $json.subject }}"
            },
            {
              "type": "TextBlock",
              "text": "={{ $json.message }}",
              "wrap": true
            }
          ],
          "actions": [
            {
              "type": "Action.OpenUrl",
              "title": "View Details",
              "url": "={{ $json.url || \"#\" }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.microsoftTeams",
      "typeVersion": 1,
      "position": [1120, 400],
      "id": "send-teams-message"
    },
    {
      "parameters": {
        "resource": "Work Packages",
        "operation": "Create Work Package",
        "subject": "={{ 'Notification: ' + $json.subject }}",
        "description": "={{ 'A notification has been sent.\\n\\nType: ' + $json.notification_type + '\\n\\nTo: ' + ($json.to || $json.channel) + '\\n\\nMessage: ' + $json.message + ($json.details ? '\\n\\nDetails: ' + $json.details : '') }}",
        "_links": {
          "project": {
            "href": "/api/v3/projects/1"
          },
          "type": {
            "href": "/api/v3/types/1"
          }
        }
      },
      "type": "n8n-nodes-base.openProject",
      "typeVersion": 1,
      "position": [1120, 600],
      "id": "log-notification-to-openproject"
    }
  ],
  "connections": {
    "notification-webhook": {
      "main": [
        [
          {
            "node": "check-notification-type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-notification-type": {
      "main": [
        [
          {
            "node": "send-email",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "check-if-slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send-email": {
      "main": [
        [
          {
            "node": "log-notification-to-openproject",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-if-slack": {
      "main": [
        [
          {
            "node": "send-slack-message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "check-if-teams",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send-slack-message": {
      "main": [
        [
          {
            "node": "log-notification-to-openproject",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-if-teams": {
      "main": [
        [
          {
            "node": "send-teams-message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "log-notification-to-openproject",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "send-teams-message": {
      "main": [
        [
          {
            "node": "log-notification-to-openproject",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "saveManualExecutions": true
  }
}
